!function(e){e.CitySelect=function(e,a){this.config=a,this.wrap=e},e.extend(e.CitySelect.prototype,{init:function(){var e=this.config,a=this.wrap,t=a.find("select").eq(0);this.setUpdateCache(),this.changeSelect(),this.createOptions(t,0,e.prov)},createOptions:function(a,t,r){var i=this,c=this.config,o=(i.wrap,c.data||{});o[c.paramName]=r||"",o.level=t+1;var n=this.getStorageCache(t,r);return n?(i.generateOption({curSelect:a,index:t,data:n}),!1):(c.setParam.call(a,t+1,r),void e.ajax({type:"POST",url:c.url,data:o,dataType:"json",error:function(){},success:function(e){i.setStorageCache(e.data,t,r),i.generateOption({curSelect:a,index:t,data:e.data})}}))},generateOption:function(a){var t=a.curSelect,r=a.index,i=a.data,c=this.config;if(t.find("option:gt(0)").remove(),i&&i.length>0){var o="",n="";switch(r){case 0:o="\u8bf7\u9009\u62e9\u7701",n=c.provDef,c.provDef="";break;case 1:o="\u8bf7\u9009\u62e9\u5e02",n=c.cityDef,c.cityDef="";break;case 2:o="\u8bf7\u9009\u62e9\u53bf/\u533a",n=c.districtDef,c.districtDef=""}var l;e.each(i,function(e){var a=this,r=a[c.valueProperty];text=a[c.textProperty],l=c.isDedultOption?e+1:e,t[0].options[l]=new Option(text,r)}),n&&(t.val(n),t.trigger("change")),c.dataCallback.call(t,t,i)}},setStorageCache:function(e,a,t){try{if(window.localStorage&&e)if(0==a)localStorage.setItem("area-provinceData",JSON.stringify(e));else if(1==a){var r=localStorage.getItem("area-cityData"),i=r&&JSON.parse(r)||{};i[t]=e,localStorage.setItem("area-cityData",JSON.stringify(i))}else if(2==a){var c=localStorage.getItem("area-areaData"),o=c&&JSON.parse(c)||{};o[t]=e,localStorage.setItem("area-areaData",JSON.stringify(o))}}catch(n){}},getStorageCache:function(e,a){try{if(window.localStorage){if(0==e&&localStorage.getItem("area-provinceData"))return JSON.parse(localStorage.getItem("area-provinceData"));if(1==e&&localStorage.getItem("area-cityData")){var t=JSON.parse(localStorage.getItem("area-cityData"));return t[a]}if(2==e&&localStorage.getItem("area-areaData")){var r=JSON.parse(localStorage.getItem("area-areaData"));return r[a]}}return""}catch(i){}},setUpdateCache:function(){try{var e=localStorage.getItem("areaVersion")||"0.0.0";e!==this.config.version&&(localStorage.setItem("areaVersion",this.config.version),localStorage.removeItem("area-provinceData"),localStorage.removeItem("area-cityData"),localStorage.removeItem("area-areaData"))}catch(a){}},changeSelect:function(){var a=this,t=this.wrap;a.resetSelect(t.find("select:eq(0)")),t.off("change").on("change","select",function(){var r=e(this),i=r.next(),c=t.find("select").index(i);return a.config.changeCallback&&a.config.changeCallback.call(r),0==i.length?!1:(a.resetSelect(r),void a.createOptions(i,c,r.val()))})},resetSelect:function(a){var t=a;t.nextAll("select").each(function(a){e(this).find("option:gt(0)").remove()})}}),e.fn.citySelect=function(a){a=e.extend({url:"",data:null,provDef:"",cityDef:"",districtDef:"",version:"1.0.0",paramName:"areaId",valueProperty:"id",textProperty:"areaName",isDedultOption:!0,callback:null,dataCallback:function(){},changeCallback:null,setParam:function(){}},a||{});var t=this,r=new e.CitySelect(t,a);r.init()}}(window.$);